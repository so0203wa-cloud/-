<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>æœªæˆå¹´å–«ç…™é˜²æ­¢ã‚²ãƒ¼ãƒ </title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body { font-family: sans-serif; background:#f0f8ff; margin:0; padding:20px; text-align:center; }
  #game { max-width:760px; margin:auto; background:#fff; padding:20px; border-radius:8px; box-shadow:0 0 12px rgba(0,0,0,0.12); }
  .status-bar { margin:12px 0; text-align:left; font-size:16px; }
  .bar { height:28px; background:#eee; border-radius:10px; overflow:hidden; }
  .bar-fill { height:100%; width:50%; transition:width .3s; text-align:right; padding-right:10px; box-sizing:border-box; color:#fff; font-weight:bold; }
  #emotion-bar { background:#ff6b6b; }
  #friend-bar { background:#4dabf7; }
  #senpai-bar { background:#9775fa; }
  #society-bar { background:#51cf66; }
  #story { font-size:18px; min-height:72px; margin:14px 0; white-space:pre-line; }
  #choices { margin-top:10px; }
  button.choice { margin:10px 6px; padding:14px 20px; border:none; border-radius:8px; background:#4caf50; color:white; cursor:pointer; font-size:16px; }
  button.choice:hover { background:#3b9d3b; }
  ul.log { text-align:left; display:inline-block; margin-top:12px; }
  @media(max-width:520px){
    button.choice{display:block; width:90%; margin:8px auto;}
  }
</style>
</head>
<body>
  <div id="game">
    <h1>ğŸš­ æœªæˆå¹´å–«ç…™é˜²æ­¢ã‚²ãƒ¼ãƒ </h1>
    <div id="story">èª­ã¿è¾¼ã¿ä¸­â€¦</div>

    <h3>ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
    <div class="status-bar">æ„Ÿæƒ…å€¤: <span id="emotion-text">50</span>
      <div class="bar"><div id="emotion-bar" class="bar-fill" style="width:50%">50</div></div>
    </div>
    <div class="status-bar">å‹é”ã¨ã®ä¿¡é ¼: <span id="friend-text">50</span>
      <div class="bar"><div id="friend-bar" class="bar-fill" style="width:50%">50</div></div>
    </div>
    <div class="status-bar">å…ˆè¼©ã¨ã®ä¿¡é ¼: <span id="senpai-text">50</span>
      <div class="bar"><div id="senpai-bar" class="bar-fill" style="width:50%">50</div></div>
    </div>
    <div class="status-bar">ç¤¾ä¼šã¨ã®ã¤ãªãŒã‚Š: <span id="society-text">50</span>
      <div class="bar"><div id="society-bar" class="bar-fill" style="width:50%">50</div></div>
    </div>

    <div id="choices"></div>
  </div>

<script>
/*  */

const player = {
  score: 0,
  emotion: 50,
  trust: { friend: 50, senpai: 50, society: 50 }
};

let currentStory = null;   // ç¾åœ¨ã®ã‚·ãƒ¼ãƒ³é…åˆ—
let currentScene = 0;      // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
let log = [];              // é¸æŠãƒ­ã‚°

// ------- helper -------
function clamp(n, a=0, b=100){ return Math.min(b, Math.max(a, n)); }

// ------- ãƒ«ãƒ¼ãƒˆå®šç¾©ï¼ˆãã‚Œãã‚Œ12ã‚·ãƒ¼ãƒ³ï¼‰ -------
// fields: text, trustTarget (or null), choices: [{text,effect,emotion,trust,correct}]
const routes = {
  school: [
    { text: "ğŸ« æœã€å‹é”ãŒã€ä¸€å›ã ã‘ã©ã†ï¼Ÿã€ã¨è¨€ã£ã¦ãã‚‹", trustTarget: "friend",
      choices: [
        { text: "ç¬‘ã£ã¦æ–­ã‚‹", effect: 0, emotion: -5, trust: -5, correct: true },
        { text: "ã¡ã‚‡ã£ã¨ã ã‘å¸ã£ã¦ã¿ã‚‹", effect: -1, emotion: 15, trust: 10, correct: false }
      ]
    },
    { text: "æ”¾èª²å¾Œã€å±‹ä¸Šã§å…ˆè¼©ãŒèª˜ã£ã¦ãã‚‹ã€Œä¸€æœã—ãªã„ï¼Ÿã€", trustTarget: "senpai",
      choices: [
        { text: "æ–­ã‚‹", effect: 2, emotion: 10, trust: -5, correct: true },
        { text: "ã¤ã„ã¦ã„ã", effect: -2, emotion: 20, trust: 5, correct: false }
      ]
    },
    { text: "æ˜¼ä¼‘ã¿ã€å‹é”ãŒå¸ã£ã¦ã„ã‚‹ã®ã‚’è¦‹ã‹ã‘ã‚‹", trustTarget: "friend",
      choices: [
        { text: "æ³¨æ„ã™ã‚‹", effect: 1, emotion: -5, trust: 5, correct: true },
        { text: "é å·»ãã«è¦‹ã‚‹", effect: 0, emotion: 0, trust: 0, correct: true }
      ]
    },
    { text: "éƒ¨æ´»ã®å¾Œã€å…ˆè¼©ã‹ã‚‰ã€ä»Šæ—¥ã‚‚ã‚„ã‚‹ã‹ï¼Ÿã€ã¨èª˜ã‚ã‚Œã‚‹", trustTarget: "senpai",
      choices: [
        { text: "æ–­ã‚‹", effect: 2, emotion: 0, trust: -5, correct: true },
        { text: "ä¹—ã£ã¦ã—ã¾ã†", effect: -3, emotion: 15, trust: 5, correct: false }
      ]
    },
    { text: "å¸°ã‚Šé“ã€ã‚³ãƒ³ãƒ“ãƒ‹å‰ã§çŸ¥ã‚‰ãªã„å¤§äººã«å‹§ã‚ã‚‰ã‚Œã‚‹", trustTarget: "society",
      choices: [
        { text: "ç„¡è¦–ã—ã¦é€šã‚Šéãã‚‹", effect: 2, emotion: 5, trust: 0, correct: true },
        { text: "å°‘ã—è¿‘ã¥ã„ã¦ã¿ã‚‹", effect: -2, emotion: 10, trust: -5, correct: false }
      ]
    },
    { text: "å‹é”ã®SNSã«å–«ç…™å†™çœŸãŒã‚¢ãƒƒãƒ—ã•ã‚Œã‚‹", trustTarget: "friend",
      choices: [
        { text: "ã‚³ãƒ¡ãƒ³ãƒˆã—ãªã„", effect: 1, emotion: 0, trust: 2, correct: true },
        { text: "é¢ç™½ãŒã£ã¦ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã™ã‚‹", effect: -1, emotion: 5, trust: -2, correct: false }
      ]
    },
    { text: "æ–‡åŒ–ç¥­æº–å‚™ã§å…ˆè¼©é”ãŒä¼‘æ†©ä¸­ã«å–«ç…™ã—ã¦ã„ã‚‹", trustTarget: "senpai",
      choices: [
        { text: "æ³¨æ„ã¯ã—ãªã„ãŒé›¢ã‚Œã‚‹", effect: 1, emotion: 0, trust: 0, correct: true },
        { text: "å…ˆè¼©ã«åˆã‚ã›ã‚‹", effect: -2, emotion: 10, trust: 5, correct: false }
      ]
    },
    { text: "æ”¾èª²å¾Œã€å‹é”ã¨æ·±åˆ»ãªè©±ã«ãªã‚Šæ°—åˆ†ãŒè½ã¡è¾¼ã‚€", trustTarget: null,
      choices: [
        { text: "ç›¸è«‡ã—ã¦æ°—æŒã¡ã‚’è½ã¡ç€ã‘ã‚‹", effect: 1, emotion: -5, trust: 0, correct: true },
        { text: "æ°—æ™´ã‚‰ã—ã«è©¦ã™", effect: -2, emotion: 10, trust: -2, correct: false }
      ]
    },
    { text: "å®¶ã§è¦ªãŒå–«ç…™ã—ã¦ã„ã‚‹ã®ã‚’è¦‹ã‹ã‘ã‚‹", trustTarget: "society",
      choices: [
        { text: "ã€ä½“ã«æ‚ªã„ã‚ˆã€ã¨è©±ã™", effect: 2, emotion: 0, trust: 10, correct: true },
        { text: "ç¾¨ã¾ã—ãã†ã«è¦‹ã‚‹", effect: -1, emotion: 5, trust: -5, correct: false }
      ]
    },
    { text: "å¤œã€å¸æ®»ã‚’è¦‹ã¤ã‘ã‚‹ï¼ˆèª°ã®ï¼Ÿï¼‰", trustTarget: null,
      choices: [
        { text: "è¦ªã«è©±ã™", effect: 2, emotion: -5, trust: 5, correct: true },
        { text: "é»™ã£ã¦ãŠã", effect: -1, emotion: 5, trust: -2, correct: false }
      ]
    },
    { text: "ä¼‘æ—¥ã€å‹é”ãŒã€éŠã³ã«æ¥ã„ã‚ˆã€ã¨è¨€ã£ã¦å–«ç…™ã®å ´ã«èª˜ã†", trustTarget: "friend",
      choices: [
        { text: "æ–­ã‚‹", effect: 2, emotion: 0, trust: -3, correct: true },
        { text: "è¡Œã£ã¦ã—ã¾ã†", effect: -3, emotion: 15, trust: 6, correct: false }
      ]
    },
    { text: "æœ€çµ‚æ—¥ï¼šã“ã‚Œã¾ã§ã®è¡Œå‹•ã‚’æŒ¯ã‚Šè¿”ã‚‹", trustTarget: null,
      choices: [
        { text: "å–«ç…™ã—ãªã„æ±ºå¿ƒã‚’ã™ã‚‹", effect: 3, emotion: -5, trust: 0, correct: true },
        { text: "ã¾ã è©¦ã—ã¦ã¿ãŸã„æ°—æŒã¡ãŒã‚ã‚‹", effect: -2, emotion: 10, trust: -2, correct: false }
      ]
    }
  ],

  park: [
    { text: "ğŸŒ³ å…¬åœ’ã§å‹é”ãŒã€ä¸€æœã—ã‚ˆã†ãœã€ã¨è¨€ã†", trustTarget: "friend",
      choices: [
        { text: "æ–­ã‚‹", effect: 2, emotion: -5, trust: -3, correct: true },
        { text: "ä¸€ç·’ã«å¸ã†", effect: -2, emotion: 15, trust: 6, correct: false }
      ]
    },
    { text: "ãƒ™ãƒ³ãƒã§è¦‹çŸ¥ã‚‰ã¬å¤§äººãŒè¿‘ã¥ã„ã¦ãã‚‹", trustTarget: "society",
      choices: [
        { text: "é›¢ã‚Œã‚‹", effect: 2, emotion: 5, trust: 0, correct: true },
        { text: "è©±ã‚’èã", effect: -3, emotion: 10, trust: -5, correct: false }
      ]
    },
    { text: "å‹é”ã®ä¸€äººãŒã‚¿ãƒã‚³ã‚’å¸ã„å§‹ã‚ã‚‹", trustTarget: "friend",
      choices: [
        { text: "æ³¨æ„ã™ã‚‹", effect: 1, emotion: -5, trust: 4, correct: true },
        { text: "è‡ªåˆ†ã‚‚å¸ã£ã¦ã¿ã‚‹", effect: -2, emotion: 12, trust: 3, correct: false }
      ]
    },
    { text: "ã‚¹ãƒãƒ¼ãƒ„å¸°ã‚Šã«å…ˆè¼©ã¨ã™ã‚Œé•ã†", trustTarget: "senpai",
      choices: [
        { text: "æŒ¨æ‹¶ã—ã¦ç«‹ã¡å»ã‚‹", effect: 1, emotion: 0, trust: 0, correct: true },
        { text: "å…ˆè¼©ã®èª˜ã„ã«ä¹—ã‚‹", effect: -2, emotion: 15, trust: 5, correct: false }
      ]
    },
    { text: "å™´æ°´ä»˜è¿‘ã§ã‚°ãƒ«ãƒ¼ãƒ—ãŒå–«ç…™ã—ã¦ã„ã‚‹", trustTarget: "society",
      choices: [
        { text: "é ãã‹ã‚‰è¦‹ã‚‹", effect: 1, emotion: 0, trust: 0, correct: true },
        { text: "è¼ªã«å…¥ã‚‹", effect: -3, emotion: 15, trust: -4, correct: false }
      ]
    },
    { text: "å‹é”ã®SNSã§å–«ç…™ã‚’è¤’ã‚ã‚‹æŠ•ç¨¿ã‚’è¦‹ã¤ã‘ã‚‹", trustTarget: "friend",
      choices: [
        { text: "ä½•ã‚‚è¨€ã‚ãªã„", effect: 1, emotion: 0, trust: 2, correct: true },
        { text: "ç¾¨ã¾ã—ãŒã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã™ã‚‹", effect: -1, emotion: 5, trust: -2, correct: false }
      ]
    },
    { text: "å¤œã®å…¬åœ’ã§å†ã³èª˜ã‚ã‚Œã‚‹", trustTarget: "friend",
      choices: [
        { text: "æ–­ã‚‹", effect: 2, emotion: -5, trust: -3, correct: true },
        { text: "ä¸€ç·’ã«å¸ã†", effect: -2, emotion: 15, trust: 6, correct: false }
      ]
    },
    { text: "è¿‘ãã§æœªæˆå¹´ã«å£²ã‚ã†ã¨ã™ã‚‹äººã‚’è¦‹ã‹ã‘ã‚‹", trustTarget: "society",
      choices: [
        { text: "çŸ¥ã‚‰ã›ã‚‹", effect: 2, emotion: -5, trust: 5, correct: true },
        { text: "è¦‹ã¦è¦‹ã¬ãµã‚Š", effect: -1, emotion: 5, trust: -3, correct: false }
      ]
    },
    { text: "å¤§ä¼šå‰ã§ç·Šå¼µã€å‹é”ãŒã€ä¸€æœ¬ã§è½ã¡ç€ã‘ã€ã¨è¨€ã†", trustTarget: "friend",
      choices: [
        { text: "æ·±å‘¼å¸ã—ã¦æ–­ã‚‹", effect: 2, emotion: -5, trust: -2, correct: true },
        { text: "è¨€ã‚ã‚ŒãŸé€šã‚Šã«å¸ã†", effect: -2, emotion: 10, trust: 4, correct: false }
      ]
    },
    { text: "å¸°ã‚Šé“ã€å¸æ®»ã‚’è¦‹ã¤ã‘ã‚‹", trustTarget: null,
      choices: [
        { text: "æ‹¾ã†ï¼ˆç‰‡ä»˜ã‘ï¼‰", effect: 1, emotion: -2, trust: 2, correct: true },
        { text: "ç„¡è¦–ã™ã‚‹", effect: -1, emotion: 3, trust: -2, correct: false }
      ]
    },
    { text: "å…¬åœ’ã§å¹´é•·è€…ãŒèª¬æ•™ã—ã¦ã„ã‚‹ã®ã‚’èã", trustTarget: "society",
      choices: [
        { text: "è©±ã‚’èã", effect: 1, emotion: -2, trust: 2, correct: true },
        { text: "ç«‹ã¡å»ã‚‹", effect: 0, emotion: 0, trust: 0, correct: true }
      ]
    },
    { text: "ä¸€æ—¥ã®çµ‚ã‚ã‚Šã«æ±ºæ„ã‚’æŒ¯ã‚Šè¿”ã‚‹", trustTarget: null,
      choices: [
        { text: "å¸ã‚ãªã„ã¨æ±ºã‚ã‚‹", effect: 3, emotion: -5, trust: 0, correct: true },
        { text: "ã¾ã è©¦ã—ãŸã„æ°—æŒã¡ãŒæ®‹ã‚‹", effect: -2, emotion: 10, trust: -2, correct: false }
      ]
    }
  ],

  home: [
    { text: "ğŸ  å®¶ã§è¦ªãŒå–«ç…™ã—ã¦ã„ã‚‹ã®ã‚’è¦‹ã‹ã‘ã‚‹", trustTarget: "society",
      choices: [
        { text: "æ³¨æ„ã™ã‚‹", effect: 2, emotion: -5, trust: 8, correct: true },
        { text: "é»™ã£ã¦è¦‹ã‚‹", effect: -1, emotion: 5, trust: -3, correct: false }
      ]
    },
    { text: "å…„ãŒå‹é”ã¨ã‚¿ãƒã‚³ã‚’å¸ã£ã¦ã„ã‚‹ã®ã‚’è¦‹ã‹ã‘ã‚‹", trustTarget: "friend",
      choices: [
        { text: "æ­¢ã‚ã‚‹", effect: 2, emotion: -5, trust: 3, correct: true },
        { text: "èˆˆå‘³ã‚’ç¤ºã™", effect: -2, emotion: 10, trust: 5, correct: false }
      ]
    },
    { text: "ãƒªãƒ“ãƒ³ã‚°ã§å‹é”ãŒæ¥ã¦ã‚¿ãƒã‚³ã‚’å‡ºã™", trustTarget: "friend",
      choices: [
        { text: "æ–­ã‚‹", effect: 2, emotion: -5, trust: -2, correct: true },
        { text: "å°‘ã—ã ã‘è©¦ã™", effect: -2, emotion: 10, trust: 4, correct: false }
      ]
    },
    { text: "ã‚¹ãƒãƒ›ã§å–«ç…™å‹•ç”»ã‚’è¦‹ã¦ã—ã¾ã†", trustTarget: null,
      choices: [
        { text: "ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦æˆ‘æ…¢ã™ã‚‹", effect: 2, emotion: -3, trust: 0, correct: true },
        { text: "çœŸä¼¼ã—ã¦è©¦ã—ã¦ã¿ã‚‹", effect: -2, emotion: 12, trust: -2, correct: false }
      ]
    },
    { text: "è¿‘æ‰€ã§å–«ç…™è€…ã‚’è¦‹ã‹ã‘ã‚‹", trustTarget: "society",
      choices: [
        { text: "æ³¨æ„ã—ãªã„", effect: 0, emotion: 0, trust: 0, correct: true },
        { text: "æ³¨æ„ã™ã‚‹", effect: 1, emotion: -3, trust: 2, correct: true }
      ]
    },
    { text: "å®¶æ—ã®é£²ã¿ä¼šã§ã‚¿ãƒã‚³ãŒå‡ºã‚‹", trustTarget: "society",
      choices: [
        { text: "æ–­ã‚‹", effect: 2, emotion: -5, trust: 2, correct: true },
        { text: "ä»˜ãåˆã£ã¦ã—ã¾ã†", effect: -2, emotion: 10, trust: -3, correct: false }
      ]
    },
    { text: "å‹é”ã‹ã‚‰å¤œã«èª˜ã„ã®LINEãŒæ¥ã‚‹", trustTarget: "friend",
      choices: [
        { text: "æ–­ã‚‹", effect: 2, emotion: -3, trust: -2, correct: true },
        { text: "è¡Œã£ã¦ã—ã¾ã†", effect: -2, emotion: 12, trust: 5, correct: false }
      ]
    },
    { text: "è‡ªå®¤ã§å­¤ç‹¬æ„Ÿã‚’æ„Ÿã˜ã‚‹", trustTarget: null,
      choices: [
        { text: "é›»è©±ã§ç›¸è«‡ã™ã‚‹", effect: 1, emotion: -5, trust: 0, correct: true },
        { text: "æ°—æ™´ã‚‰ã—ã«è©¦ã™", effect: -2, emotion: 12, trust: -1, correct: false }
      ]
    },
    { text: "å…„ãŒç…™è‰ã‚’å¤–ã§æ¨ã¦ã‚‹ã®ã‚’è¦‹ã‹ã‘ã‚‹", trustTarget: null,
      choices: [
        { text: "æ³¨æ„ã™ã‚‹", effect: 1, emotion: -3, trust: 2, correct: true },
        { text: "é»™ã£ã¦ãŠã", effect: -1, emotion: 4, trust: -2, correct: false }
      ]
    },
    { text: "è¦ªãŒå–«ç…™ã®å¥åº·è¢«å®³ã«ã¤ã„ã¦è©±ã™å ´é¢ã‚’è¦‹ã‚‹", trustTarget: "society",
      choices: [
        { text: "è©±ã‚’èã", effect: 2, emotion: -3, trust: 2, correct: true },
        { text: "èãæµã™", effect: 0, emotion: 0, trust: -1, correct: false }
      ]
    },
    { text: "æ·±å¤œã€èª˜æƒ‘ã«ã‹ã‚‰ã‚Œã‚‹å ´é¢", trustTarget: null,
      choices: [
        { text: "æˆ‘æ…¢ã™ã‚‹", effect: 2, emotion: -5, trust: 0, correct: true },
        { text: "è©¦ã™", effect: -2, emotion: 12, trust: -2, correct: false }
      ]
    },
    { text: "ä¸€æ—¥ã®çµ‚ã‚ã‚Šã«æ±ºæ„ã‚’æŒ¯ã‚Šè¿”ã‚‹", trustTarget: null,
      choices: [
        { text: "å¸ã‚ãªã„é¸æŠã‚’ç¶šã‘ã‚‹", effect: 3, emotion: -5, trust: 0, correct: true },
        { text: "ã¾ã è¿·ã£ã¦ã„ã‚‹", effect: -2, emotion: 10, trust: -2, correct: false }
      ]
    }
  ],

  store: [
    { text: "ğŸª ã‚³ãƒ³ãƒ“ãƒ‹å‰ã§å¤§äººã«ã€1æœ¬ã©ã†ã ï¼Ÿã€ã¨å£°ã‚’ã‹ã‘ã‚‰ã‚Œã‚‹", trustTarget: "society",
      choices: [
        { text: "ç„¡è¦–ã—ã¦é€šã‚‹", effect: 2, emotion: 5, trust: 0, correct: true },
        { text: "è©±ã‚’èã„ã¦ã¿ã‚‹", effect: -3, emotion: 12, trust: -5, correct: false }
      ]
    },
    { text: "å‹é”ãŒåº—ã§ã‚¿ãƒã‚³ã‚’å‡ºã—ã¦èª˜ã†", trustTarget: "friend",
      choices: [
        { text: "æ–­ã‚‹", effect: 2, emotion: -3, trust: -2, correct: true },
        { text: "ä¸€ç·’ã«è²·ã£ã¦ã¿ã‚‹", effect: -2, emotion: 12, trust: 5, correct: false }
      ]
    },
    { text: "ãƒ¬ã‚¸ã§æœªæˆå¹´ã ã¨æ°—ã¥ã‹ã‚Œãã†ã«ãªã‚‹", trustTarget: null,
      choices: [
        { text: "æ½”ãæ–­ã‚‹", effect: 2, emotion: -5, trust: 0, correct: true },
        { text: "ã”ã¾ã‹ã™", effect: -1, emotion: 5, trust: -3, correct: false }
      ]
    },
    { text: "åº—å…ˆã§å‹é”ãŒå¸ã„å§‹ã‚ã‚‹", trustTarget: "friend",
      choices: [
        { text: "æ³¨æ„ã™ã‚‹", effect: 1, emotion: -3, trust: 3, correct: true },
        { text: "è‡ªåˆ†ã‚‚è©¦ã™", effect: -2, emotion: 12, trust: 4, correct: false }
      ]
    },
    { text: "åº—ã®è£ã§è¦‹çŸ¥ã‚‰ã¬äººãŒå£°ã‚’ã‹ã‘ã‚‹", trustTarget: "society",
      choices: [
        { text: "é€ƒã’ã‚‹", effect: 2, emotion: 5, trust: 0, correct: true },
        { text: "é–¢ã‚ã£ã¦ã—ã¾ã†", effect: -3, emotion: 15, trust: -5, correct: false }
      ]
    },
    { text: "å¤œã€å‹é”ã¨åº—å‰ã§é›†ã¾ã‚‹", trustTarget: "friend",
      choices: [
        { text: "å¸°ã‚‹", effect: 2, emotion: -3, trust: -2, correct: true },
        { text: "ãã®ã¾ã¾å¸ã†", effect: -2, emotion: 12, trust: 5, correct: false }
      ]
    },
    { text: "åº—ã§åƒãå¤§äººãŒã€ä¸€æœ¬ã©ã†ã ã€ã¨å‹§ã‚ã‚‹", trustTarget: "society",
      choices: [
        { text: "ãã£ã±ã‚Šæ–­ã‚‹", effect: 2, emotion: -5, trust: 3, correct: true },
        { text: "æ‰‹ã‚’å‡ºã™", effect: -3, emotion: 12, trust: -4, correct: false }
      ]
    },
    { text: "å‹é”ã®å‰ã§æ ¼å¥½ã¤ã‘ã‚‹æµã‚Œã«ãªã‚‹", trustTarget: "friend",
      choices: [
        { text: "æ–­ã‚‹", effect: 2, emotion: -3, trust: -2, correct: true },
        { text: "çœŸä¼¼ã—ã¦å¸ã†", effect: -2, emotion: 15, trust: 6, correct: false }
      ]
    },
    { text: "æ·±å¤œã€åº—å‰ã§å…ˆè¼©ã«ä¼šã†", trustTarget: "senpai",
      choices: [
        { text: "æ–­ã‚‹", effect: 2, emotion: -3, trust: -3, correct: true },
        { text: "å…ˆè¼©ã«åˆã‚ã›ã‚‹", effect: -3, emotion: 15, trust: 5, correct: false }
      ]
    },
    { text: "å¸°å®…æ™‚ã€å¸æ®»ã‚’è¦‹ã¤ã‘ã¦å«Œãªæ°—æŒã¡ã«ãªã‚‹", trustTarget: null,
      choices: [
        { text: "æ‹¾ã£ã¦æ¨ã¦ã‚‹", effect: 1, emotion: -2, trust: 2, correct: true },
        { text: "ç„¡è¦–ã™ã‚‹", effect: -1, emotion: 4, trust: -2, correct: false }
      ]
    },
    { text: "å‹é”ã®æŠ•ç¨¿ã§å–«ç…™ã‚’å‹§ã‚ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã‚‹", trustTarget: "friend",
      choices: [
        { text: "ã‚³ãƒ¡ãƒ³ãƒˆã—ãªã„", effect: 1, emotion: 0, trust: 2, correct: true },
        { text: "èˆˆå‘³ã‚’ç¤ºã™ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã™ã‚‹", effect: -1, emotion: 6, trust: -2, correct: false }
      ]
    },
    { text: "æœ€çµ‚å¤œã€ä»Šæ—¥ã®åˆ¤æ–­ã‚’æŒ¯ã‚Šè¿”ã‚‹", trustTarget: null,
      choices: [
        { text: "å¸ã‚ãªã„ã¨æ±ºã‚ã‚‹", effect: 3, emotion: -5, trust: 0, correct: true },
        { text: "ã¾ã è©¦ã—ã¦ã¿ãŸã„", effect: -2, emotion: 10, trust: -2, correct: false }
      ]
    }
  ]
};

// ---------- ã‚²ãƒ¼ãƒ å‡¦ç† ----------
function chooseRandomRoute() {
  const keys = Object.keys(routes);
  const pick = keys[Math.floor(Math.random()*keys.length)];
  currentStory = routes[pick];
  currentScene = 0;
  log = [];
  // reset player stats for a fresh run
  player.score = 0;
  player.emotion = 50;
  player.trust.friend = 50;
  player.trust.senpai = 50;
  player.trust.society = 50;
}

function updateStatus() {
  const e = clamp(player.emotion);
  const f = clamp(player.trust.friend);
  const s = clamp(player.trust.senpai);
  const so = clamp(player.trust.society);
  document.getElementById("emotion-bar").style.width = e + "%";
  document.getElementById("emotion-bar").textContent = e;
  document.getElementById("emotion-text").textContent = e;
  document.getElementById("friend-bar").style.width = f + "%";
  document.getElementById("friend-bar").textContent = f;
  document.getElementById("friend-text").textContent = f;
  document.getElementById("senpai-bar").style.width = s + "%";
  document.getElementById("senpai-bar").textContent = s;
  document.getElementById("senpai-text").textContent = s;
  document.getElementById("society-bar").style.width = so + "%";
  document.getElementById("society-bar").textContent = so;
  document.getElementById("society-text").textContent = so;
}

function showScene() {
  // safety: if no route chosen, pick one
  if (!currentStory) chooseRandomRoute();

  if (currentScene >= currentStory.length) {
    return ending();
  }

  const scene = currentStory[currentScene];
  const storyEl = document.getElementById("story");
  storyEl.textContent = scene.text;

  const choicesDiv = document.getElementById("choices");
  choicesDiv.innerHTML = "";

  scene.choices.forEach((choice, idx) => {
    const btn = document.createElement("button");
    btn.className = "choice";
    btn.textContent = choice.text;
    btn.addEventListener("click", () => {
      // ãƒ­ã‚°ä¿å­˜
      log.push({ text: choice.text, correct: !!choice.correct });
      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
      player.score += (choice.effect || 0);
      player.emotion = clamp(player.emotion + (choice.emotion || 0));
      if (scene.trustTarget && typeof choice.trust === "number") {
        player.trust[scene.trustTarget] = clamp(player.trust[scene.trustTarget] + choice.trust);
      }
      // æ¬¡ã¸
      currentScene++;
      updateStatus();
      showScene();
    });
    choicesDiv.appendChild(btn);
  });
}

function ending() {
  const storyEl = document.getElementById("story");
  let msg = "ğŸ¬ ã‚²ãƒ¼ãƒ çµ‚äº† ğŸ¬\n\n";

  // ç§°å·åˆ¤å®š
  const ach = [];
  if (player.score > 4) ach.push("ğŸŒŸ å¥åº·ã‚’å®ˆã£ãŸãƒ’ãƒ¼ãƒ­ãƒ¼");
  if (player.score <= -3) ach.push("ğŸš¬ æµã•ã‚Œã‚„ã™ã„äºº");
  if (player.trust.friend < 30) ach.push("ğŸ™… å­¤ç«‹ã—ãŸæŒ‘æˆ¦è€…");
  if (player.emotion >= 80) ach.push("ğŸ˜“ ã‚¹ãƒˆãƒ¬ã‚¹ãƒ•ãƒ«");
  if (ach.length) msg += "ğŸ† ã‚ãªãŸã®ç§°å·:\n" + ach.join(" / ") + "\n\n";

  // æ­£èª¤ã‚«ã‚¦ãƒ³ãƒˆ
  const total = log.length;
  const correct = log.filter(l => l.correct).length;
  msg += `âœ… æ­£ã—ã„åˆ¤æ–­: ${correct} / ${total}\n\n`;

  if (total === 0) msg += "ï¼ˆé¸æŠãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼‰\n";
  else if (correct === total) msg += "ğŸŒŸ å…¨ã¦æ­£è§£ï¼å¥åº·çš„ãªé¸æŠã‚’ç¶šã‘ã‚‰ã‚Œãã†ã§ã™ã€‚\n";
  else if (correct >= total/2) msg += "âš–ï¸ å¤šãã¯æ­£ã—ã„åˆ¤æ–­ã§ã—ãŸã€‚è‰¯ã„å‚¾å‘ã§ã™ã€‚\n";
  else msg += "âš ï¸ èª¤ã£ãŸé¸æŠãŒå¤šã‚ã§ã™ã€‚ãƒªã‚¹ã‚¯ã‚’æ¸›ã‚‰ã™æ–¹æ³•ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚\n";

  msg += "\nğŸ“– è§£èª¬ãƒ¢ãƒ¼ãƒ‰:\nãƒ»ã‚¿ãƒã‚³ã¯ä¾å­˜æ€§ãŒé«˜ãæœªæˆå¹´ã§å§‹ã‚ã‚‹ã¨ã‚„ã‚ã«ãããªã‚Šã¾ã™ã€‚\n";
  msg += "ãƒ»æ–­ã‚‹å‹‡æ°—ã‚„ç›¸è«‡ã™ã‚‹ç¿’æ…£ãŒé•·æœŸçš„ã«å¥åº·ã‚’å®ˆã‚Šã¾ã™ã€‚\n";

  storyEl.textContent = msg;

  // é¸æŠãƒ­ã‚°è¡¨ç¤º & ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
  const choicesDiv = document.getElementById("choices");
  choicesDiv.innerHTML = "<h3>ğŸ“œ ã‚ãªãŸã®é¸æŠãƒ­ã‚°</h3>";
  const ul = document.createElement("ul");
  ul.className = "log";
  log.forEach(item => {
    const li = document.createElement("li");
    li.textContent = `${item.text} - ${item.correct ? "æ­£ã—ã„" : "èª¤ã‚Š"}`;
    ul.appendChild(li);
  });
  choicesDiv.appendChild(ul);

  const resetBtn = document.createElement("button");
  resetBtn.className = "choice";
  resetBtn.textContent = "ğŸ”„ ã‚‚ã†ä¸€åº¦éŠã¶ï¼ˆåˆ¥ãƒ«ãƒ¼ãƒˆï¼‰";
  resetBtn.addEventListener("click", () => {
    chooseRandomRoute();
    updateStatus();
    // small delay to ensure UI updates clearly
    setTimeout(() => { showScene(); }, 80);
  });
  choicesDiv.appendChild(resetBtn);
}

// åˆæœŸåŒ–å®Ÿè¡Œ
chooseRandomRoute();
updateStatus();
showScene();

</script>
</body>
</html>
